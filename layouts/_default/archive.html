{{ define "main" }}
  {{ partial "container_open.html" . }}
    <div class="py-6 md:py-8">
      <section class="hero">
        <h1>Archive</h1>
        <p>All posts, grouped by year.</p>
        <div class="accent-rule"></div>
      </section>

      {{ $posts := sort (where .Site.RegularPages "Section" "posts") "Date" "desc" }}
      {{ if gt (len $posts) 0 }}
        {{ $groups := $posts.GroupByDate "2006-01" }}
        <div class="archive-layout">
          <div class="archive-main">
            {{ range $groups }}
              {{ $groupDate := time (printf "%s-01" .Key) }}
              {{ $year := $groupDate.Format "2006" }}
              {{ $monthName := $groupDate.Format "January" }}
              {{ $sectionId := printf "ym-%s" .Key }}

              <section id="{{ $sectionId }}" class="archive-section">
                <h2 class="archive-heading">
                  <span class="archive-year">{{ $year }}</span>
                  <span class="muted">·</span>
                  <span class="archive-month">{{ $monthName }}</span>
                </h2>

                <ul class="post-list">
                  {{ range .Pages }}
                    <li class="post-row archive-post-row">
                      <div class="post-row-meta" style="margin-bottom: 4px;">
                        <time datetime="{{ .Date.Format "2006-01-02" }}">{{ .Date.Format "Jan 2" }}</time>
                      </div>
                      <h3 class="post-row-title archive-post-title">
                        <a href="{{ .RelPermalink }}">{{ .Title }}</a>
                      </h3>
                    </li>
                  {{ end }}
                </ul>
              </section>
            {{ end }}
          </div>

          <aside class="archive-toc" aria-label="Archive navigation">
            <div class="archive-toc-inner">
              <div class="archive-toc-title">Jump</div>
              <nav>
                <ul class="archive-toc-list">
                  {{ range $groups }}
                    {{ $groupDate := time (printf "%s-01" .Key) }}
                    {{ $year := $groupDate.Format "2006" }}
                    {{ $monthName := $groupDate.Format "January" }}
                    {{ $sectionId := printf "ym-%s" .Key }}
                    <li>
                      <a class="archive-toc-link" href="#{{ $sectionId }}">{{ $year }} · {{ $monthName }}</a>
                    </li>
                  {{ end }}
                </ul>
              </nav>
            </div>
          </aside>
        </div>
      {{ else }}
        <div class="empty-state">
          <p>No posts yet.</p>
          <p>Add Markdown under <span class="mono">content/posts/YYYY/MM/DD/slug/index.md</span>.</p>
        </div>
      {{ end }}
    </div>
  {{ partial "container_close.html" . }}
{{ end }}
