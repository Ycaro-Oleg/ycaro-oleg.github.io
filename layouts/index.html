{{ define "main" }}
  {{ partial "container_open.html" . }}
    <div class="py-6 md:py-8">
      <section class="hero">
        <h1>{{ .Site.Title }}</h1>
        <p>{{ .Site.Params.description }}</p>
        <div class="accent-rule"></div>
      </section>

      {{ $posts := sort (where .Site.RegularPages "Section" "posts") "Date" "desc" }}
      {{ if gt (len $posts) 0 }}
        {{ $groups := $posts.GroupByDate "2006-01" }}
        <div class="archive-layout">
          <div class="archive-main">
            {{ range $groups }}
              {{ $groupDate := time (printf "%s-01" .Key) }}
              {{ $year := $groupDate.Format "2006" }}
              {{ $monthName := $groupDate.Format "January" }}
              {{ $sectionId := printf "home-ym-%s" .Key }}

              <section id="{{ $sectionId }}" class="archive-section">
                <h2 class="archive-heading">
                  <span class="archive-year">{{ $year }}</span>
                  <span class="muted">·</span>
                  <span class="archive-month">{{ $monthName }}</span>
                </h2>

                <ul class="post-list">
                  {{ range .Pages }}
                    <li class="post-row archive-post-row">
                      <div class="post-row-meta">
                        <time datetime="{{ .Date.Format "2006-01-02" }}">{{ .Date.Format "Jan 2, 2006" }}</time>
                        <span aria-hidden="true">·</span>
                      </div>

                      <h2 class="post-row-title archive-post-title">
                        <a href="{{ .RelPermalink }}">
                          {{ partial "i18n_text.html" (dict "en" .Params.title_en "ptbr" .Params.title_ptbr "fallback" .Title) }}
                        </a>
                      </h2>

                      {{ $descFallback := .Params.description }}
                      {{ $descEn := .Params.description_en }}
                      {{ $descPt := .Params.description_ptbr }}
                      {{ if or $descFallback (or $descEn $descPt) }}
                        <p class="post-row-excerpt">
                          {{ partial "i18n_text.html" (dict "en" $descEn "ptbr" $descPt "fallback" $descFallback) }}
                        </p>
                      {{ end }}

                      {{ with .Params.tags }}
                        <div class="tag-row" aria-label="Tags">
                          {{ range first 4 . }}
                            <a class="tag-chip" href="{{ (printf "/tags/%s/" (. | urlize)) | relURL }}">{{ . }}</a>
                          {{ end }}
                        </div>
                      {{ end }}
                    </li>
                  {{ end }}
                </ul>
              </section>
            {{ end }}
          </div>

          <aside class="archive-toc" aria-label="Home navigation">
            <div class="archive-toc-inner">
              <div class="archive-toc-title">Jump</div>
              <nav>
                <ul class="archive-toc-list">
                  {{ range $groups }}
                    {{ $groupDate := time (printf "%s-01" .Key) }}
                    {{ $year := $groupDate.Format "2006" }}
                    {{ $monthName := $groupDate.Format "January" }}
                    {{ $sectionId := printf "home-ym-%s" .Key }}
                    <li>
                      <a class="archive-toc-link" href="#{{ $sectionId }}">{{ $year }} · {{ $monthName }}</a>
                    </li>
                  {{ end }}
                </ul>
              </nav>
            </div>
          </aside>
        </div>

        {{ partial "social_links.html" . }}
      {{ else }}
        <div class="empty-state">
          <p>No posts yet.</p>
          <p>Add Markdown under <span class="mono">content/posts/YYYY/MM/DD/slug/index.md</span>.</p>
        </div>
      {{ end }}
    </div>
  {{ partial "container_close.html" . }}
{{ end }}
